@{
    var data = SL.Data.SQL.Query("select TeacherID,TeacherName,Video,Cover,Description,Sort from Teacher order by Sort desc");
    if (data != null)
    {
        data.All(a =>
        {
            a.Cover = SL.Util.RequestFile.FullUrl(a.Cover);
            a.Video = SL.Util.RequestFile.FullUrl(a.Video);
            return true;
        });
    }

    ViewBag.Title = "教师团队";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="http://vjs.zencdn.net/4.10/video-js.css" rel="stylesheet">
<script src="http://vjs.zencdn.net/4.10/video.js"></script>
<div class="headerwrap">
    <div style="width:100%;background: url(@Url.Content("~/Theme/Images/Teachers.jpg")) no-repeat center center;height:542px; position:absolute; "></div>
    @Html.Partial("_Header", "teachers")
</div>
<div class="main">
    @if (data != null && data.Count != 0)
    {
        var item = data.FirstOrDefault();
        <div class="lesson_info clearfix js_info" data-id="@item.TeacherID" data-video="@item.Video">
            <div class="img"><video id="really-cool-video" class="video-js vjs-default-skin" controls preload="auto" width="655" height="392" poster="@item.Cover" data-setup='{}'>
                  <source src="@item.Video" type='video/mp4'>
                </video>
                <img src="@item.Cover" style="display:none" /> </div>
            <div class="info"><p class="name">@(new MvcHtmlString(item.Title))</p>
                <p class="con">@(new MvcHtmlString(item.Description))</p>
                <p class="action"><input class="btn js_start" data-id="@item.TeacherID" type="button" value="立即预约"></p>
            </div>
        </div>
    }
    <div class="lesson_list js_list">
        @if (data == null || data.Count == 0)
        {
            <text><div style="padding: 50px; text-align: center;">暂无教师</div></text>
        }
        else
        {
            <ul>
                @foreach (var item in data)
                {
                    <li data-id="@item.TeacherID" data-src="@item.Cover" data-video="@item.Video"><p class="img"><img src="@item.Cover" /></p>
                        <p class="name">@(new MvcHtmlString(item.Title))</p>
                        <p class="con">@(new MvcHtmlString(item.Description))</p>
                    </li>
                }
            </ul>
        }
    </div>
</div>
<script>
    seajs.use(['jquery','site/user'],function ($,user) {

        var player=videojs('really-cool-video',{},function () {
        });

        var video=$('.js_info').data('video');
        if(!video) {
            player.hide();
            $('.js_info img').show();
        }

        user.loading('.js_start',function () {
            var $btn=this;

            return {
                url: '/json/user/islogin',
                success: function (res) {
                    if(!res.isLogin) {
                        user.showLogin();
                    } else {
                        location.href="/schedule.html?teacherid="+$btn.data('id');
                    }
                }
            }
        });

        $('.js_list').on('click','[data-id]',function (e) {
            var $target=$(e.currentTarget),
                $info=$('.js_info'),
                id=$target.data('id');

            if(id!=$info.data('id')) {
                var video=$target.data('video'),
                    src=$target.data('src');

                if(video) {
                    player.src([{ type: "video/mp4",src: video}]);
                    $('.js_info img').hide();
                    player.poster(src);
                    player.show();
                } else {
                    player.hide();
                    $('.js_info img').show();
                }

                $('.js_start').data('id',id);
                $info.data('id',id);
                $info.find('img').attr('src',$target.data('src'));
                $info.find('.name').html($target.find('.name').html());
                $info.find('.con').html($target.find('.con').html());
            }

        });
    });
</script>
